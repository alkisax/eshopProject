tags:
  - name: Transactions
    description: Transaction management routes

paths:
  /api/transaction:
    get:
      summary: Get all transactions (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '500':
          description: Server error

    post:
      summary: Create a new transaction (internal / checkout flow)
      description: >
        Creates a transaction after a successful Stripe, IRIS or COD checkout.
        This endpoint is used internally by the checkout flow.
      tags: [Transactions]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - participant
                - sessionId
              properties:
                participant:
                  type: string
                  format: objectId
                sessionId:
                  type: string
      responses:
        '201':
          description: Transaction created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Transaction'
        '400':
          description: Invalid input
        '500':
          description: Server error

  /api/transaction/unprocessed:
    get:
      summary: Get unprocessed transactions (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of unprocessed transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '500':
          description: Server error

  /api/transaction/iris:
    get:
      summary: Get all IRIS transactions (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of IRIS transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '500':
          description: Server error

  /api/transaction/cod:
    get:
      summary: Get all Cash On Delivery transactions (admin only)
      description: >
        COD transactions require manual approval.
      tags: [Transactions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of COD transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '500':
          description: Server error

  /api/transaction/my:
    get:
      summary: Get my transactions (logged-in user)
      tags: [Transactions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '500':
          description: Server error

  /api/transaction/status/{token}:
    get:
      summary: Get public transaction status by tracking token
      tags: [Transactions]
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transaction status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        enum: [pending, confirmed, shipped]
                      cancelled:
                        type: boolean
        '400':
          description: Missing token
        '404':
          description: Transaction not found
        '500':
          description: Server error

  /api/transaction/participant/{participantId}:
    get:
      summary: Get transactions by participant (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: participantId
          required: true
          schema:
            type: string
            format: objectId
      responses:
        '200':
          description: Participant transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '404':
          description: Participant not found
        '500':
          description: Server error

  /api/transaction/{id}:
    get:
      summary: Get transaction by ID (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: objectId
      responses:
        '200':
          description: Transaction found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '404':
          description: Transaction not found
        '500':
          description: Server error

    delete:
      summary: Delete transaction permanently (admin only)
      description: >
        Permanently deletes a transaction.
        This action is irreversible.
      tags: [Transactions]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: objectId
      responses:
        '200':
          description: Transaction deleted successfully
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '404':
          description: Transaction not found
        '500':
          description: Server error

  /api/transaction/toggle/{id}:
    put:
      summary: Toggle processed status (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transaction updated
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '404':
          description: Transaction not found
        '500':
          description: Server error

  /api/transaction/confirm/{id}:
    post:
      summary: Confirm transaction (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transaction confirmed
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '404':
          description: Transaction not found
        '500':
          description: Server error

  /api/transaction/ship/{id}:
    post:
      summary: Ship transaction (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transaction shipped
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '404':
          description: Transaction not found
        '500':
          description: Server error

  /api/transaction/cancel/{id}:
    post:
      summary: Cancel transaction (admin only)
      description: >
        Marks a transaction as cancelled (soft cancel).
      tags: [Transactions]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: objectId
      responses:
        '200':
          description: Transaction cancelled
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Transaction'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '404':
          description: Transaction not found
        '500':
          description: Server error

  /api/transaction/clear/old:
    delete:
      summary: Delete old processed transactions (admin only)
      tags: [Transactions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Old transactions deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)
        '500':
          description: Server error
